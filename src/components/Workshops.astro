---
const workshops = [
  {
    date: '15 Abr',
    time: '14:00 - 17:00',
    title: 'Gestión de Ansiedad y Estrés',
    desc: 'Herramientas cognitivo-conductuales para recuperar la calma en entornos de alta presión.',
    price: '$95',
    type: 'Presencial & Virtual',
    spots: '12 plazas disponibles',
    level: 'Todos los niveles',
    instructor: 'Daniela Montali',
    full: `Este taller intensivo de 3 horas está diseñado para personas que experimentan ansiedad crónica, estrés laboral o dificultad para desconectarse. A través de un enfoque basado en la Terapia Cognitivo-Conductual (TCC) y técnicas de regulación del sistema nervioso autónomo, aprenderás a identificar los desencadenantes de tu ansiedad y a interrumpir el ciclo de pensamiento catastrófico antes de que escale.`,
    program: [
      { time: '14:00', label: 'Bienvenida y evaluación inicial de niveles de estrés' },
      { time: '14:30', label: 'Mapa cognitivo: identificar pensamientos automáticos' },
      { time: '15:15', label: 'Técnicas de regulación: respiración diafragmática y grounding' },
      { time: '16:00', label: 'Reestructuración conductual y plan de acción personal' },
      { time: '16:45', label: 'Cierre, preguntas y kit de recursos digitales' },
    ],
    includes: [
      'Material de trabajo impreso y digital',
      'Grabación de las meditaciones guiadas',
      'Acceso al grupo privado de seguimiento (30 días)',
      'Consulta grupal de seguimiento a las 2 semanas',
    ],
    tags: ['TCC', 'Regulación emocional', 'Neurociencia aplicada'],
    refs: [
      { label: 'APA — Trastornos de ansiedad', url: 'https://www.apa.org/topics/anxiety' },
      { label: 'Hofmann et al. (2012) — Eficacia de la TCC', url: 'https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3584580/' },
    ],
  },
  {
    date: '22 Abr',
    time: '10:00 - 13:00',
    title: 'El Arte de la Autocompasión',
    desc: 'Aprendé a romper el ciclo del diálogo interno negativo y construí una relación sana con vos mismo/a.',
    price: '$80',
    type: 'Virtual',
    spots: '20 plazas disponibles',
    level: 'Principiantes y nivel medio',
    instructor: 'Daniela Montali',
    full: `Basado en el protocolo MSC (Mindful Self-Compassion) de Kristin Neff y Christopher Germer, este taller explora cómo el autocriticismo excesivo activa los mismos circuitos cerebrales que el acoso social. Aprenderás a reconocer el sufrimiento propio sin amplificarlo, a tratarte con la misma amabilidad que ofrecerías a alguien que querés, y a construir una base emocional más estable y resiliente frente a los errores y fracasos.`,
    program: [
      { time: '10:00', label: 'Introducción: ¿Qué es la autocompasión y qué NO es?' },
      { time: '10:40', label: 'Ejercicio: El crítico interior — cartografiar su voz' },
      { time: '11:20', label: 'Práctica de Loving-Kindness Meditation (LKM)' },
      { time: '12:00', label: 'Diálogo compasivo: reescribir la narrativa personal' },
      { time: '12:40', label: 'Integración y compromisos de práctica diaria' },
    ],
    includes: [
      'Workbook de autocompasión (PDF descargable)',
      'Audio de meditaciones guiadas (5 prácticas)',
      'Acceso a la comunidad privada online',
      'Hoja de práctica diaria de 7 días',
    ],
    tags: ['Autocompasión', 'Mindfulness', 'Psicología positiva'],
    refs: [
      { label: 'Neff & Germer — The Mindful Self-Compassion Workbook', url: 'https://self-compassion.org/the-research/' },
      { label: 'Zessin et al. (2015) — Autocompasión y bienestar', url: 'https://pubmed.ncbi.nlm.nih.gov/25778996/' },
    ],
  },
  {
    date: '6 May',
    time: '18:00 - 21:00',
    title: 'Vínculos Conscientes',
    desc: 'Transformá tus patrones relacionales desde el apego y la comunicación no violenta.',
    price: '$110',
    type: 'Presencial',
    spots: '10 plazas disponibles',
    level: 'Nivel medio y avanzado',
    instructor: 'Daniela Montali',
    full: `Nuestros patrones de relación se forman en la infancia y se repiten de manera inconsciente en cada vínculo adulto: pareja, familia, amistad, trabajo. Este taller combina la Teoría del Apego de Bowlby con herramientas de Comunicación No Violenta (CNV) para ayudarte a identificar tu estilo de apego dominante, comprender cómo ese patrón genera conflictos recurrentes, y desarrollar estrategias concretas para relacionarte desde un lugar más seguro y auténtico.`,
    program: [
      { time: '18:00', label: 'Test de estilos de apego y reflexión guiada' },
      { time: '18:45', label: 'Dinámicas inconscientes: perseguidor, distante, ansioso' },
      { time: '19:30', label: 'Introducción práctica a la CNV: necesidades vs. estrategias' },
      { time: '20:15', label: 'Role-play: conversaciones difíciles desde el apego seguro' },
      { time: '20:50', label: 'Cierre y hoja de ruta personal para los próximos 30 días' },
    ],
    includes: [
      'Evaluación de estilo de apego personalizada',
      'Guía de CNV para el día a día (impresa)',
      'Sesión de seguimiento grupal online (15 días después)',
      'Acceso al canal privado de la comunidad',
    ],
    tags: ['Teoría del apego', 'CNV', 'Relaciones sanas'],
    refs: [
      { label: 'Bowlby (1988) — A Secure Base', url: 'https://www.taylorfrancis.com/books/mono/10.4324/9780203440841/secure-base-john-bowlby' },
      { label: 'Rosenberg — Comunicación No Violenta (CNV)', url: 'https://www.cnvc.org/learn-nvc/what-is-nvc' },
    ],
  },
  {
    date: '10 Jun',
    time: '10:00 - 13:00',
    title: 'AUTOADOLE',
    desc: 'Taller de autoconocimiento y regulación emocional especialmente diseñado para adolescentes.',
    price: '$70',
    type: 'Presencial',
    spots: '15 plazas disponibles',
    level: 'Adolescentes (13–17 años)',
    instructor: 'Daniela Montali',
    url: 'https://eltribunodejujuy.com/informacion-general/2025-8-25-0-0-0-taller-para-adolescentes',
    urlLabel: 'Taller para adolescentes',
    full: `AUTOADOLE es un espacio seguro y dinámico creado específicamente para adolescentes de 13 a 17 años. A través de actividades vivenciales, juegos de rol, dinámicas grupales y herramientas adaptadas a su etapa de desarrollo, los y las participantes aprenderán a reconocer y nombrar sus emociones, a gestionar la presión social, el miedo al juicio y la autocrítica, y a construir una identidad más sólida y compasiva. El taller integra principios de la psicología del desarrollo, la neurociencia adolescente y la Terapia de Aceptación y Compromiso (ACT) en un formato accesible y cercano.`,
    program: [
      { time: '10:00', label: 'Bienvenida y dinámica de presentación: "Quién soy hoy"' },
      { time: '10:30', label: 'Mapa emocional: identificar y nombrar lo que sentimos' },
      { time: '11:15', label: 'La presión social y el miedo al juicio — ejercicio grupal' },
      { time: '12:00', label: 'Herramientas ACT: valores personales y acción comprometida' },
      { time: '12:30', label: 'Cierre: carta a mi yo del futuro y compromisos de autocuidado' },
    ],
    includes: [
      'Cuaderno de trabajo AUTOADOLE (impreso)',
      'Tarjetas de regulación emocional para llevar',
      'Acceso al grupo de seguimiento para participantes',
      'Guía para familias: cómo acompañar el proceso',
    ],
    tags: ['Adolescentes', 'ACT', 'Autoconocimiento', 'Regulación emocional'],
    refs: [
      { label: 'OPS — Salud mental de adolescentes', url: 'https://www.paho.org/es/temas/salud-mental-adolescentes' },
      { label: 'Hayes et al. — ACT: Terapia de Aceptación y Compromiso', url: 'https://contextualscience.org/act' },
      { label: 'UNICEF — Bienestar emocional en la adolescencia', url: 'https://www.unicef.org/es/salud-mental' },
    ],
  },
];
---

<section class="py-32 bg-background-light" id="talleres">
  <div class="max-w-7xl mx-auto px-6">

    <div class="flex flex-col md:flex-row justify-between items-end gap-8 mb-16 reveal-organic">
      <div class="max-w-2xl">
        <h4 class="text-primary font-bold uppercase tracking-[0.3em] text-xs mb-4">Próximos Encuentros</h4>
        <h2 class="text-4xl md:text-5xl font-light tracking-tight text-text-main">
          Talleres de <span class="italic font-serif">crecimiento</span>
        </h2>
      </div>
      <a href="#" class="text-[10px] font-bold uppercase tracking-widest text-text-main border-b-2 border-primary pb-1 hover:text-primary transition-all">
        Ver calendario completo
      </a>
    </div>

    <div class="space-y-5">
      {workshops.map((w, i) => (
        <div 
          class="workshop-card reveal-organic rounded-[2.5rem] overflow-hidden border border-gray-100 bg-white shadow-sm transition-shadow duration-500"
          style={`transition-delay: ${i * 100}ms`}
          data-open="false"
        >

          <!-- HEADER — siempre visible, click para expandir -->
          <div class="workshop-header group flex flex-col lg:flex-row cursor-pointer select-none">

            <!-- Fecha -->
            <div class="lg:w-1/4 bg-accent-sage/30 flex flex-col items-center justify-center p-8 text-center
                        transition-colors duration-500 workshop-date-block">
              <span class="text-4xl font-light text-text-main transition-colors workshop-date-text">{w.date}</span>
              <span class="text-[10px] uppercase tracking-widest font-bold text-text-muted transition-colors mt-2 workshop-spots-text">{w.spots}</span>
            </div>

            <!-- Info principal -->
            <div class="flex-1 p-8 lg:p-10 flex flex-col md:flex-row justify-between items-start md:items-center gap-6 lg:gap-8">
              <div class="space-y-3">
                <div class="flex flex-wrap gap-3 lg:gap-4 text-[10px] font-bold uppercase tracking-widest text-primary">
                  <span class="flex items-center gap-1">
                    <span class="material-symbols-outlined text-sm">schedule</span> {w.time || 'TBA'}
                  </span>
                  <span class="flex items-center gap-1">
                    <span class="material-symbols-outlined text-sm">location_on</span> {w.type}
                  </span>
                  <span class="flex items-center gap-1">
                    <span class="material-symbols-outlined text-sm">person</span> {w.instructor}
                  </span>
                </div>

                <div class="flex items-center gap-3 flex-wrap">
                  <h3 class="text-xl lg:text-2xl font-bold text-text-main">{w.title}</h3>
                  {w.url && (
                    <a
                      href={w.url}
                      target="_blank"
                      rel="noopener noreferrer"
                      onclick="event.stopPropagation()"
                      class="inline-flex items-center gap-1.5 text-[9px] font-bold uppercase tracking-wider
                             text-primary bg-primary/8 border border-primary/20 px-3 py-1.5 rounded-full
                             hover:bg-primary hover:text-white hover:border-primary transition-all duration-300"
                    >
                      <span class="material-symbols-outlined text-[12px]">open_in_new</span>
                      {w.urlLabel || 'Ver más'}
                    </a>
                  )}
                </div>

                <p class="text-text-muted font-light max-w-xl text-sm lg:text-base">{w.desc}</p>

                <!-- Tags -->
                <div class="flex flex-wrap gap-2 pt-1">
                  {w.tags.map(tag => (
                    <span class="text-[10px] font-bold uppercase tracking-wider text-primary bg-primary/8 px-3 py-1 rounded-full border border-primary/15">
                      {tag}
                    </span>
                  ))}
                </div>
              </div>

              <div class="flex flex-row md:flex-col items-center gap-4 flex-shrink-0 w-full md:w-auto">
                <span class="text-2xl font-light text-text-main">{w.price}</span>
                <button 
                  class="workshop-reserve bg-text-main text-white px-6 lg:px-8 py-3 rounded-full text-[10px] font-bold uppercase tracking-widest hover:bg-primary transition-all flex-1 md:flex-none text-center"
                  onclick="event.stopPropagation()"
                >
                  Reservar Plaza
                </button>
                <span class="workshop-toggle hidden md:flex items-center gap-1 text-[10px] font-bold uppercase tracking-widest text-primary/60 transition-all duration-300">
                  <span class="material-symbols-outlined text-base workshop-toggle-icon transition-transform duration-300">expand_more</span>
                  Ver detalles
                </span>
              </div>
            </div>
          </div>

          <!-- EXPANDED CONTENT -->
          <div class="workshop-expanded" style="display:none; opacity:0;">
            <div class="border-t border-gray-100 mx-6 lg:mx-8 mb-0"></div>
            <div class="grid md:grid-cols-2 gap-0">

              <!-- Columna izquierda: descripción + programa + referencias -->
              <div class="p-8 lg:p-10 border-b md:border-b-0 md:border-r border-gray-100/80 space-y-8">

                <div>
                  <h4 class="text-xs font-bold uppercase tracking-[0.25em] text-primary mb-4">Sobre el taller</h4>
                  <p class="text-text-muted font-light leading-relaxed text-sm">{w.full}</p>
                </div>

                <div>
                  <h4 class="text-xs font-bold uppercase tracking-[0.25em] text-primary mb-4">Programa</h4>
                  <ul class="space-y-3">
                    {w.program.map((p) => (
                      <li class="flex items-start gap-4">
                        <span class="text-[11px] font-bold text-primary bg-primary/8 px-2 py-1 rounded-lg flex-shrink-0 mt-0.5 font-mono">
                          {p.time}
                        </span>
                        <span class="text-sm text-text-main font-light leading-snug">{p.label}</span>
                      </li>
                    ))}
                  </ul>
                </div>

                <!-- Referencias -->
                {w.refs && w.refs.length > 0 && (
                  <div>
                    <h4 class="text-xs font-bold uppercase tracking-[0.25em] text-primary mb-4 flex items-center gap-2">
                      <span class="material-symbols-outlined text-sm">library_books</span>
                      Referencias y fuentes
                    </h4>
                    <ul class="space-y-2">
                      {w.refs.map(ref => (
                        <li>
                          <a
                            href={ref.url}
                            target="_blank"
                            rel="noopener noreferrer"
                            onclick="event.stopPropagation()"
                            class="group/ref flex items-start gap-2.5 text-xs text-text-muted font-light hover:text-primary transition-colors duration-300"
                          >
                            <span class="material-symbols-outlined text-primary/40 group-hover/ref:text-primary text-sm flex-shrink-0 mt-0.5 transition-colors duration-300">open_in_new</span>
                            <span class="underline underline-offset-2 decoration-primary/20 group-hover/ref:decoration-primary transition-all duration-300">{ref.label}</span>
                          </a>
                        </li>
                      ))}
                    </ul>
                  </div>
                )}

              </div>

              <!-- Columna derecha: incluye + info práctica -->
              <div class="p-8 lg:p-10 space-y-8">

                <div>
                  <h4 class="text-xs font-bold uppercase tracking-[0.25em] text-primary mb-4">Qué incluye</h4>
                  <ul class="space-y-3">
                    {w.includes.map(item => (
                      <li class="flex items-start gap-3 text-sm text-text-main font-light">
                        <span class="material-symbols-outlined text-primary text-base flex-shrink-0 mt-0.5">check_circle</span>
                        {item}
                      </li>
                    ))}
                  </ul>
                </div>

                <div class="space-y-3 bg-background-light/70 rounded-2xl p-6">
                  <div class="flex items-center gap-3 text-sm">
                    <span class="material-symbols-outlined text-primary text-base">school</span>
                    <span class="text-text-muted font-light">Nivel: <strong class="text-text-main font-semibold">{w.level}</strong></span>
                  </div>
                  <div class="flex items-center gap-3 text-sm">
                    <span class="material-symbols-outlined text-primary text-base">group</span>
                    <span class="text-text-muted font-light">Capacidad: <strong class="text-text-main font-semibold">{w.spots}</strong></span>
                  </div>
                  <div class="flex items-center gap-3 text-sm">
                    <span class="material-symbols-outlined text-primary text-base">person_pin</span>
                    <span class="text-text-muted font-light">Instructor/a: <strong class="text-text-main font-semibold">{w.instructor}</strong></span>
                  </div>
                  <div class="flex items-center gap-3 text-sm">
                    <span class="material-symbols-outlined text-primary text-base">videocam</span>
                    <span class="text-text-muted font-light">Modalidad: <strong class="text-text-main font-semibold">{w.type}</strong></span>
                  </div>
                </div>

                {w.url && (
                  <a
                    href={w.url}
                    target="_blank"
                    rel="noopener noreferrer"
                    onclick="event.stopPropagation()"
                    class="w-full flex items-center justify-center gap-2 border border-primary text-primary py-3.5 rounded-2xl text-[10px] font-bold uppercase tracking-widest hover:bg-primary hover:text-white transition-all duration-300"
                  >
                    <span class="material-symbols-outlined text-sm">open_in_new</span>
                    {w.urlLabel || 'Ver más información'}
                  </a>
                )}

                <button 
                  class="w-full bg-primary text-white py-4 rounded-2xl text-[10px] font-bold uppercase tracking-widest hover:bg-primary/90 transition-all"
                  onclick="event.stopPropagation()"
                >
                  Reservar mi plaza — {w.price}
                </button>

              </div>
            </div>
          </div>

        </div>
      ))}
    </div>
  </div>
</section>

<script>
  document.querySelectorAll<HTMLElement>('.workshop-card').forEach(card => {
    const header     = card.querySelector<HTMLElement>('.workshop-header')!;
    const expanded   = card.querySelector<HTMLElement>('.workshop-expanded')!;
    const toggleIcon = card.querySelector<HTMLElement>('.workshop-toggle-icon');
    const toggleLabel = card.querySelector<HTMLElement>('.workshop-toggle');
    const dateBlock  = card.querySelector<HTMLElement>('.workshop-date-block')!;
    const dateText   = card.querySelector<HTMLElement>('.workshop-date-text')!;
    const spotsText  = card.querySelector<HTMLElement>('.workshop-spots-text')!;

    header.addEventListener('click', () => {
      const isOpen = card.dataset.open === 'true';

      if (isOpen) {
        // COLAPSAR: instantáneo
        expanded.style.transition = 'none';
        expanded.style.opacity    = '0';
        expanded.style.display    = 'none';
        card.dataset.open         = 'false';
        card.style.boxShadow      = '';

        if (toggleIcon) toggleIcon.style.transform = '';
        if (toggleLabel) toggleLabel.innerHTML = '<span class="material-symbols-outlined text-base workshop-toggle-icon" style="display:inline-block">expand_more</span> Ver detalles';

        dateBlock.style.background = '';
        dateText.style.color       = '';
        spotsText.style.color      = '';

      } else {
        // EXPANDIR: animación suave
        expanded.style.display    = 'block';
        expanded.style.transition = 'none';
        expanded.style.opacity    = '0';
        expanded.style.transform  = 'translateY(-8px)';

        requestAnimationFrame(() => requestAnimationFrame(() => {
          expanded.style.transition = 'opacity 450ms ease, transform 450ms ease';
          expanded.style.opacity    = '1';
          expanded.style.transform  = 'translateY(0)';
        }));

        card.dataset.open    = 'true';
        card.style.boxShadow = '0 20px 60px rgba(7,28,31,0.12)';

        if (toggleIcon) toggleIcon.style.transform = 'rotate(180deg)';
        if (toggleLabel) toggleLabel.innerHTML = '<span class="material-symbols-outlined text-base" style="display:inline-block;transform:rotate(180deg)">expand_more</span> Cerrar';

        dateBlock.style.background = 'var(--color-primary, #0a6460)';
        dateText.style.color       = 'white';
        spotsText.style.color      = 'rgba(255,255,255,0.75)';

        setTimeout(() => {
          card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }, 100);
      }
    });
  });
</script>